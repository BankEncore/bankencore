<!-- app/views/party/identifiers/_list.html.erb -->
<section class="card">
  <details class="rounded-box border p-3 open:pt-3">
    <summary class="flex items-center gap-2 cursor-pointer">
      <span class="text-sm font-medium">Identifiers</span>
      <span class="badge"><%= @party.identifiers.count %></span>

      <% if local_assigns[:show_add] %>
        <span class="ml-auto">
          <%= link_to "Add",
            new_party_party_identifier_path(@party),
            class: "btn btn-ghost btn-xs",
            data: { turbo_frame: "comm_modal_frame" },
            onclick: "event.stopPropagation()" %>
        </span>
      <% end %>
    </summary>

    <div class="pt-3">
      <ul role="list" class="space-y-3">
        <% @party.identifiers.order(is_primary: :desc, created_at: :asc).each do |pi| %>
          <li class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <div class="text-sm font-medium">
                <%= t("id_types.#{pi.id_type_code}", default: pi.id_type_code.upcase) %>
                <% if pi.is_primary? %><span class="badge badge-sm ml-2">Primary</span><% end %>
              </div>
              <div class="text-sm opacity-80"><%= pi.value_masked.presence || "••••" %></div>
              <% if pi.country_code.present? || pi.issuing_authority.present? || pi.expires_on.present? %>
                <div class="text-xs opacity-60">
                  <%= [pi.country_code, pi.issuing_authority].compact.join(" • ") %>
                  <% if pi.expires_on %> • Expires <%= pi.expires_on %><% end %>
                </div>
              <% end %>
            </div>

            <div class="shrink-0">
              <%= link_to "Details",
                    party_party_identifier_path(@party, pi),
                    class: "btn btn-sm btn-outline",
                    data: {
                      controller: "frame-link",
                      action: "frame-link#open",
                      frame_link_url_value: party_party_identifier_path(@party, pi),
                      frame_link_frame_value: "comm_modal_frame"
                    },
                    onclick: "event.stopPropagation()" %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </details>
</section>
