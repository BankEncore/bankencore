<!DOCTYPE html>
<html lang="en" data-theme="blueLight">
  <head>
    <title><%= content_for?(:title) ? yield(:title) : "BankEncoRRe" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script>
      (function(){
        const KEY="daisy-theme",root=document.documentElement;
        const saved=localStorage.getItem(KEY);
        if(saved) root.setAttribute("data-theme",saved);
        document.addEventListener("change",e=>{
          const t=e.target;
          if(t?.classList?.contains("theme-controller")){
            root.setAttribute("data-theme",t.value);
            try{localStorage.setItem(KEY,t.value);}catch(_){}
          }
        });
        document.addEventListener("DOMContentLoaded",()=>{
          const current=root.getAttribute("data-theme")||"blueLight";
          document.querySelectorAll(".theme-controller").forEach(el=>{el.checked=(el.value===current);});
        });
      })();
    </script>
    <!-- SVG (preferred) -->
    <link rel="icon" type="image/svg+xml" href="<%= asset_path('favicon.svg') %>">

    <!-- PNG fallbacks -->
    <link rel="icon" sizes="32x32"  type="image/png" href="<%= asset_path('favicon-32.png') %>">
    <link rel="icon" sizes="192x192" type="image/png" href="<%= asset_path('favicon-192.png') %>">
    <link rel="icon" sizes="512x512" type="image/png" href="<%= asset_path('favicon-512.png') %>">

    <!-- iOS/Android home screen -->
    <link rel="apple-touch-icon" sizes="180x180" href="<%= asset_path('favicon-180.png') %>">

    <!-- Safari pinned tab (optional) -->
    <link rel="mask-icon" href="<%= asset_path('mask-icon.svg') %>" color="#8E3B3B">

    <!-- Address bar color (optional) -->
    <meta name="theme-color" content="#F9F5F0">
  </head>

  <body class="min-h-screen">
    <header class="bg-base-100 border-b">
      <div class="max-w-7xl mx-auto flex flex-row flex-wrap md:flex-nowrap items-center justify-between gap-3 px-4 md:px-6 py-3">

        <!-- left: logo -->
        <%= link_to root_path, class: "flex items-center gap-2 shrink-0" do %>
          <%= render "shared/logo" %>
        <% end %>

        <!-- center: nav -->
        <nav class="hidden md:flex flex-1 justify-center items-center gap-2" role="navigation" aria-label="Main">
          <%= link_to "Home", root_path, class: "btn btn-ghost btn-sm" %>
          <%= link_to "Parties", party_parties_path, class: "btn btn-ghost btn-sm" %>
          <%= link_to "Cases", "#", class: "btn btn-ghost btn-sm" %>
          <%= link_to "Reports", "#", class: "btn btn-ghost btn-sm" %>
        </nav>

        <!-- right: actions -->
        <div class="flex items-center gap-3 shrink-0">
          <%= form_with url: party_parties_path, method: :get, local: true, class: "join hidden md:flex" do %>
            <input name="q" aria-label="Search parties" class="input input-bordered join-item w-64 md:w-80" placeholder="Search by name or customer #">
            <button class="btn join-item" type="submit">Search</button>
          <% end %>

          <%= link_to "New Party", new_party_party_path, class: "btn btn-primary btn-sm hidden md:inline-flex" %>

          <div class="dropdown dropdown-end">
              <button tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="User menu">
                <span class="w-8 h-8 rounded-full bg-base-300 text-base-content grid place-items-center">
                  <svg class="w-5 h-5 block" viewBox="0 0 24 24" aria-label="User">
                    <title>User</title>
                    <path fill="currentColor"
                      d="M12 14c-3.9 0-7 1.8-7 4v1h14v-1c0-2.2-3.1-4-7-4Zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"/>
                  </svg>
                </span>
              </button>
            <div tabindex="0" class="dropdown-content z-10 bg-base-100 rounded-box shadow p-3 w-64">
              <div class="mb-2 text-sm font-semibold">Appearance</div>
              <div class="grid grid-cols-2 gap-2 text-sm">
                <% ["blueLight","merlotLight","blueDark","merlotDark"].each do |t| %>
                  <label class="label cursor-pointer justify-start gap-2">
                    <input type="radio" name="theme" value="<%= t %>" class="theme-controller">
                    <span><%= t.gsub(/([a-z])([A-Z])/,'\1 \2').split.map(&:capitalize).join(' ') %></span>
                  </label>
                <% end %>
              </div>
              <div class="divider my-2"></div>
              <ul class="menu">
                <li><a href="#">Profile</a></li>
                <li><a href="#">Sign out</a></li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 md:px-6 py-6">
      <% flash.each do |type, msg| %>
        <% tone = { notice: "info", alert: "warning", error: "error", success: "success" }[type.to_sym] || "info" %>
        <div class="alert alert-<%= tone %> mb-3"><%= msg %></div>
      <% end %>
      <%= yield %>
    </main>

    <footer class="border-t">
      <div class="max-w-7xl mx-auto p-4 text-sm opacity-70">
        © <%= Time.current.year %> YourApp · <a href="#" class="link">Privacy</a>
      </div>
    </footer>
  </body>
</html>
